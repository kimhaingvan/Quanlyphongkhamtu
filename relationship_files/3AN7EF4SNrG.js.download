if (self.CavalryLogger) { CavalryLogger.start_js(["+VFPh"]); }

__d("RTWebCallWindowOpener",["requireCond","cr:1099565"],(function(a,b,c,d,e,f){"use strict";e.exports=b("cr:1099565")}),null);
__d("ZenonCallInviteModelTypes",[],(function(a,b,c,d,e,f){"use strict";a={missed:"missed",ringing:"ringing",unsupported_browser:"unsupported_browser"};f.CallInviteModelType=a}),null);
__d("ZenonCallInviteModel",["BaseEventEmitter","FBLogger","ZenonCallInviteModelTypes","gkx"],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this)||this;d.$ZenonCallInviteModel3=function(a){b("FBLogger")("rtc_www").info("Received cancel for: ",a.ringID);if(d.__currentRequest&&d.__currentRequest.model&&d.__currentRequest.model.ringID===a.ringID)switch(a.reason){case"hangup":a=((a=d.__currentRequest)==null?void 0:(a=a.model)==null?void 0:a.type)!==b("ZenonCallInviteModelTypes").CallInviteModelType.unsupported_browser;d.__currentRequest.model=babelHelpers["extends"]({},d.__currentRequest.model,{type:"missed"});a&&d.emit("callInvite",d.__currentRequest.model);break;default:d.dismiss();break}};d.$ZenonCallInviteModel2=function(a){var c;b("FBLogger")("rtc_www").info("Receiving ring: ",a.ringID);if(((c=d.__currentRequest)==null?void 0:(c=c.model)==null?void 0:c.type)==="ringing"){if(((c=d.__currentRequest)==null?void 0:(c=c.model)==null?void 0:c.ringID)!==a.ringID&&b("gkx")("1434282")){a.onDecline("InAnotherCall");b("FBLogger")("rtc_www").info("Sending InAnotherCall to ring: ",a.ringID,"Current ring: ",(c=d.__currentRequest)==null?void 0:(c=c.model)==null?void 0:c.ringID)}}else d.__currentRequest={model:{context:a.context,controllerParams:a.controllerParams,inviterID:a.inviterID,participants:a.otherParticipants,requestingVideo:a.requestingVideo,ringID:a.ringID,type:a.isClientPermissableRing?"ringing":"unsupported_browser"},ringPayload:a},d.emit("callInvite",d.__currentRequest.model),a.isClientPermissableRing||a.onDecline("VersionUnsupported")};d.__eventSource=c;d.__currentRequest=null;return d}var d=c.prototype;d.getCurrentInvite=function(){var a;return(a=(a=this.__currentRequest)==null?void 0:a.model)!=null?a:null};d.startListening=function(a){a=a.callsBlocked;this.__currentRequest&&this.dismiss();this.stopListening();a?this.__eventSource.addListener("incomingRing",this.$ZenonCallInviteModel1):(this.__eventSource.addListener("incomingRing",this.$ZenonCallInviteModel2),this.__eventSource.addListener("ringCancel",this.$ZenonCallInviteModel3))};d.stopListening=function(){this.__eventSource.removeAllListeners("incomingRing"),this.__eventSource.removeAllListeners("ringCancel"),this.__currentRequest=null};d.dismiss=function(){var a;b("FBLogger")("rtc_www").info("Dismissing ring: ",(a=this.__currentRequest)==null?void 0:(a=a.model)==null?void 0:a.ringID);this.__currentRequest=null;this.emit("callInvite",Object.freeze(null))};d.accept=function(a,c){var d=this.__currentRequest;if(d){var e;b("FBLogger")("rtc_www").info("Accepting ring: ",(e=d.model)==null?void 0:e.ringID);((e=d.model)==null?void 0:e.type)==="ringing"&&d.ringPayload.onAccept(a,c);this.dismiss()}};d.decline=function(a,c){a===void 0&&(a="IgnoreCall");var d=this.__currentRequest;if(d){var e;b("FBLogger")("rtc_www").info("Declining ring: ",(e=d.model)==null?void 0:e.ringID);d.ringPayload.onDecline(a,c);this.dismiss();return}};d.$ZenonCallInviteModel1=function(a){b("FBLogger")("rtc_www").info("Blocking ring: ",a.ringID),a.onDecline("IgnoreCall","CallsBlocked")};return c}(b("BaseEventEmitter"));e.exports=a}),null);
__d("delegateZenonCallInviteModel",[],(function(a,b,c,d,e,f){"use strict";e.exports=a;function a(a,b){a.getCurrentInvite=b.getCurrentInvite.bind(b),a.startListening=b.startListening.bind(b),a.stopListening=b.stopListening.bind(b),a.dismiss=b.dismiss.bind(b),a.accept=b.accept.bind(b),a.decline=b.decline.bind(b),b.addListener("callInvite",function(b){a.emit("callInvite",b)})}}),null);
__d("ZenonCallWindowController",["Promise","FBLogger","ZenonCallWindowErrors"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){var c=b.callWindowInitializerResource,d=b.callWindowOpener;b=b.uriBuilderResource;this.$2=null;this.$3=!1;this.$5=null;this.$1=a;this.$7=b;this.$4=c;this.$6=d}var c=a.prototype;c.initCall=function(a){var c=this;if(this.$3)throw new(b("ZenonCallWindowErrors").OpeningAnotherCallError)();try{if(this.$2&&!this.$2.closed&&a.joinContext.type==="thread"&&this.$2.inCallWith===a.joinContext.thread.id){this.$2.focus();return[this.$2,b("Promise").resolve({alohaEscalatedMW:!1})]}}catch(a){b("FBLogger")("rtc_www").catching(a).warn("Failed to access inCallWith on call window")}var d=this.$6.openWindow(a);try{this.$2&&(this.$2.closed||this.$2.close(),this.$2=null)}catch(a){b("FBLogger")("rtc_www").catching(a).warn("Failed to access close on call window")}this.$2=d;this.$3=!0;return[d,b("Promise").all([this.$7.load(),this.$4.load()]).then(function(b){var d=b[0];b=b[1];c.$5===null&&(c.$5=new b(c.$1,new d(c.$1)));return c.$5.initCall(c.$2,a)})["finally"](function(){c.$3=!1})]};return a}();e.exports=a}),null);
__d("ZenonCallWindowOpener_Popup",["ZenonUserActionLogger","qex"],(function(a,b,c,d,e,f){"use strict";var g=1280,h={LargeForGroup:{height:772,width:1100},LargeForP2P:{height:720,width:1280},Small:{height:540,width:960}},i=["menubar=no","location=no","scrollbars=no","status=no","personalbar=no"];a=function(){function a(){}var c=a.prototype;c.openWindow=function(a){a=this.$1(a.joinContext);var c=this.$2(a),d=c.left;c=c.top;b("ZenonUserActionLogger").logCheckpoint({checkpoint:"Opening_Popup: left="+d+",top="+c+",width="+a.width+",height="+a.height});return window.open("","",[].concat(i,["height="+a.height,"width="+a.width,"left="+d,"top="+c]).join(","))};c.$1=function(a){if(screen&&screen.width>g)if(a.type==="link"||a.thread.type===2){a=b("qex")._("1704108");return{height:a!=null&&a>0?a:h.LargeForGroup.height,width:h.LargeForGroup.width}}else{a=b("qex")._("1704109");var c=b("qex")._("1704110");return{height:a!=null&&a>0?a:h.LargeForP2P.height,width:c!=null&&c>0?c:h.LargeForP2P.width}}else{a=b("qex")._("1704111");c=b("qex")._("1704112");return{height:a!=null&&a>0?a:h.Small.height,width:c!=null&&c>0?c:h.Small.width}}};c.$2=function(a){var b=a.height;a=a.width;return{left:Math.floor(window.innerWidth/2-a/2+((a=window.screenLeft)!=null?a:window.screenX)),top:Math.floor(window.innerHeight/2-b/2+((a=window.screenTop)!=null?a:window.screenY))}};return a}();e.exports=a}),null);
__d("ScotchRTWebLoggingSharedInstance",["ChannelClientID"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=b("ChannelClientID").getID()}var c=a.prototype;c.getDeviceID=function(){return this.$1};return a}();c=new a();e.exports=c}),null);
__d("ScotchRTWebUserActionLogger",["CurrentUser","FBRTCConsoleLogger","FBRTCSupport","RtcWebUserActionsDebugFalcoEvent","RtcWebUserActionsFalcoEvent","ScotchRTWebLoggingSharedInstance","immutable","performanceNow"],(function(a,b,c,d,e,f){"use strict";var g;a=function(){function a(){this.$1={callID:void 0,callType:void 0,mediaType:void 0,conferenceName:void 0,conferenceState:void 0},this.$2=b("immutable").Map(),this.$3=new Set(),this.$4=new Set(),this.$5=b("ScotchRTWebLoggingSharedInstance").getDeviceID(),this.$6=this.$7(),this.clearCache()}var c=a.prototype;c.clearCache=function(){this.$1={callID:void 0,callType:void 0,mediaType:void 0,conferenceName:void 0,conferenceState:void 0}};c.logImpression=function(a){this.logEvent(babelHelpers["extends"]({eventName:"impression"},a))};c.logPreCallImpression=function(a){this.clearCache(),this.logImpression(a)};c.logPreCallClick=function(a){this.clearCache(),this.logClick(a)};c.logClick=function(a){this.logEvent(babelHelpers["extends"]({eventName:"tap"},a))};c.logError=function(a){this.logEvent(babelHelpers["extends"]({eventName:"error"},a))};c.startTimer=function(a){var c=(g||(g=b("performanceNow")))();this.$2=this.$2.set(a,c);this.logCheckpoint({checkpoint:a+"_timerStart"});this.$8(a,{startTime:c})};c.logStopTimer=function(a){var b=a.checkpointName===void 0?a.timerName:a.checkpointName,c=a.event||{};c.timeElapsed=this.$9(a.timerName);this.logCheckpoint(babelHelpers["extends"]({checkpoint:b+"_timerEnd"},c));return c.timeElapsed};c.logCheckpoint=function(a,b){this.logEvent(babelHelpers["extends"]({eventName:"checkpoint"},a),b)};c.$10=function(a){return a===null||a===void 0};c.logEvent=function(a,b){var c=this.$1;c.callID=this.$10(a.callID)?c.callID:a.callID;c.callType=a.callType||c.callType;c.conferenceState=a.conferenceState||c.conferenceState;c.conferenceName=this.$10(a.conferenceName)?c.conferenceName:a.conferenceName;c.isCaller=a.isCaller==null?c.isCaller:a.isCaller;c.mediaType=a.mediaType||c.mediaType;this.$11(a,c);c=this.$12(a,c);(b==null?void 0:b.noConsole)!==!0&&this.$8(a.eventName,c)};c.$12=function(a,c){var d={call_type:c.callType,client_time:Date.now().toString(),device_id:this.$5,error_domain:a.errorDomain,error_type:a.errorType,component:a.component,conference_state:c.conferenceState,event:a.eventName,media_type:c.mediaType,page:this.$6,call_id:c.callID,conference_name:c.conferenceName,surface:a.surface,checkpoint:a.checkpoint,event_time_elapsed:(a=a.timeElapsed)==null?void 0:a.toString(),is_caller:c.isCaller,codebase_version:"Scotch"};b("RtcWebUserActionsFalcoEvent").log(function(){return d});return d};c.$11=function(a,c){var d={call_type:c.callType,client_time:Date.now().toString(),device_id:this.$5,error_domain:a.errorDomain,error_type:a.errorType,component:a.component,conference_state:c.conferenceState,event:a.eventName,media_type:c.mediaType,page:this.$6,call_id:c.callID,conference_name:c.conferenceName,surface:a.surface,checkpoint:a.checkpoint,event_time_elapsed:(a=a.timeElapsed)==null?void 0:a.toString(),is_caller:c.isCaller,codebase_version:"Scotch"};b("RtcWebUserActionsDebugFalcoEvent").log(function(){return d});return d};c.getCallType=function(a,b){b===void 0&&(b=!1);if(a===null||a===void 0)return null;if(a)return"mw";else if(b)return"escalated";else return"p2p"};c.getAudioVideoComponent=function(a){return a===null||a===void 0?null:a?"audio_button":"video_button"};c.getMediaType=function(a,b){b===void 0&&(b=!1);if(b)return"escalated";else if(a)return"audio";else return"video"};c.logErrorOnceforDomain=function(a,b){this.$3.has(a)||(this.$3.add(a),this.logError({errorDomain:a,errorType:b.toString()}))};c.logCheckpointOnceForDomain=function(a){var b=a.checkpoint;this.$4.has(b)||(this.$4.add(b),this.logCheckpoint(a))};c.clearLoggedDomains=function(){this.$3.clear(),this.$4.clear()};c.getWebLoggerInfoFromStore=function(a){a=a.callInfo;var b=a.callID,c=a.conferenceName;a=a.conferenceState;return{callID:b,conferenceName:c,conferenceState:a}};c.$7=function(){if(b("FBRTCSupport").isMobileDevice())return"mweb";else if(b("CurrentUser").isWorkUser())return"workplace";var a=window.location.hostname;if(a.search("facebook")!==-1)return"facebook";else if(a.search("messenger")!==-1)return"messenger_dot_com";return a};c.$9=function(a){var c=this.$2.get(a);if(c){this.$2=this.$2.remove(a);return parseInt((g||(g=b("performanceNow")))()-c,10)}return null};c.$8=function(a,c){a=a==null?"null":a;b("FBRTCConsoleLogger").getInstance().getLogHistory().log(a,JSON.stringify(c))};return a}();c=new a();e.exports=c}),null);
__d("ZenonCallLogger",["ScotchRTWebUserActionLogger"],(function(a,b,c,d,e,f){"use strict";var g=new Set(["setMediaStats","infraAction"]);a=function(){function a(a,b){var c,d=this;this.$1=[];this.$2={localCallID:a.callID,peerID:a.peerID,sharedCallID:(c=a.serverInfoData)!=null?c:a.callID};b.forEach(function(b){return d.$1.push(new b(a))})}var c=a.prototype;c.log=function(a){g.has(a.name)||b("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"[ZP] ZenonCallLogger event: "+a.name}),this.$1.forEach(function(b){b.processEvent(a)})};c.getLogIdentifiers=function(){return this.$2};return a}();e.exports=a}),null);
__d("ZenonParentCallSummaryLogProcessor",["CurrentUser","FBRTCCallSummaryStore","ZenonCallSummary","ZenonDismissReason","gkx","pageID"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$2=b("FBRTCCallSummaryStore").getInstance(),this.$3=a.protocol,this.$3==="mw"&&(a.peerID="MW_PEER_ID"),this.$1=new(b("ZenonCallSummary"))(a)}var c=a.prototype;c.$4=function(a){if(a!=null){a=a.deviceID;a=a==="mobile";this.$1.setIsPeerMobile(a)}};c.processEvent=function(a){switch(a.name){case"inviteResponded":this.$1.onInviteResponded();break;case"inviteReceived":this.$1.onInviteReceived();this.$4(a.remoteDeviceInfo);break;case"callEnded":this.$5(a);break;case"callAccepted":this.$1.onCallAccepted(a.trigger);this.$1.save(this.$2);break;case"popupOpened":this.$6(a);this.$1.save(this.$2);break}};c.$6=function(a){this.$1.setInitByPageID(b("pageID")),this.$1.setInitByAppID(b("CurrentUser").getAppID()),this.$1.onCallEnded(b("ZenonDismissReason").ZenonDismissReason.ClientError,!1,!0,a.isPopupBlocked?"PopupBlocked":"PopupPending"),this.$1.save(this.$2)};c.$5=function(a){if(this.$3==="mw"&&a.isRemoteEnded)return;var c=a.endCallReason,d=a.endCallSubreason;a=a.isRemoteEnded;var e=b("gkx")("1148995");if(!e&&c===b("ZenonDismissReason").ZenonDismissReason.OtherInstanceHandled&&a)return;this.$1.onCallEnded(c,a,!1,d);this.$1.save(this.$2)};return a}();e.exports=a}),null);
__d("ZenonParentQPLLogProcessor",["QPLUserFlow"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$1=a.callID}var c=a.prototype;c.processEvent=function(a){switch(a.name){case"inviteReceived":b("QPLUserFlow").start(64225282,{instanceKey:+this.$1});break;case"callEnded":b("QPLUserFlow").endCancel(64225282,{instanceKey:+this.$1});break;case"callAccepted":b("QPLUserFlow").addPoint(64225282,"call_accepted",{instanceKey:+this.$1});break;case"inviteResponded":b("QPLUserFlow").addPoint(64225282,"invite_responded",{instanceKey:+this.$1});break;case"popupOpened":b("QPLUserFlow").endSuccess(64225282,{instanceKey:+this.$1});break}};return a}();e.exports=a}),null);
__d("ZenonCollisionContext",[],(function(a,b,c,d,e,f){"use strict";"use strict";f.getThreadIDAndTypeFromCollisionContext=a;function a(a){var b=null;a.groupThreadID!=null?b={id:a.groupThreadID,type:2}:a.peerID!=null&&(b={id:a.peerID,type:1});return b}}),null);
__d("ZenonParticipantState",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";f.toCallParticipantState=a;var g=b("$InternalEnum")({CONTACTING:6,RINGING:7,PENDING_APPROVAL:14,APPROVED:15,NEGOTIATING:8,CONNECTING:9,CONNECTED:10,UNKNOWN:0,DISCONNECTED:1,NO_ANSWER:2,REJECTED:3,UNREACHABLE:4,CONNECTION_DROPPED:5,PARTICIPANT_LIMIT_REACHED:11,IN_ANOTHER_CALL:12,RING_TYPE_UNSUPPORTED:13,FAILED_APPROVAL:16,HANGUP_IN_WAITING_ROOM:17});f.ZenonParticipantState=g;function a(a){if(a==null)return"disconnected";switch(a){case g.CONTACTING:return"contacting";case g.RINGING:return"ringing";case g.NEGOTIATING:case g.CONNECTING:return"connecting";case g.CONNECTED:return"connected";case g.PENDING_APPROVAL:return"pending_approval";case g.APPROVED:return"approved";case g.FAILED_APPROVAL:return"failed_approval";case g.HANGUP_IN_WAITING_ROOM:case g.UNKNOWN:case g.DISCONNECTED:case g.NO_ANSWER:case g.REJECTED:case g.UNREACHABLE:case g.CONNECTION_DROPPED:case g.PARTICIPANT_LIMIT_REACHED:case g.IN_ANOTHER_CALL:case g.RING_TYPE_UNSUPPORTED:return"disconnected"}return"disconnected"}}),null);
__d("ZenonPlatformExperiments",["ScotchRTWebUserActionLogger","gkx","qex"],(function(a,b,c,d,e,f){"use strict";f.getOpusPtimeMungeValue=a;f.isMwpp=c;f.isOpusMungeEnabled=d;f.shouldUseLobbyMode=e;f.shouldUseStateSync=g;f.shouldEnableMWSAudioNack=h;function a(){var a;return(a=b("qex")._("1426590"))!=null?a:60}function c(){var a;return(a=b("qex")._("1566745"))!=null?a:!1}function d(){var a;return(a=b("qex")._("1426589"))!=null?a:!0}function e(){var a;a=(a=b("gkx")("1450329"))!=null?a:!1;a&&b("ScotchRTWebUserActionLogger").logCheckpointOnceForDomain({checkpoint:"gk: rtc_www_lobby_mode"});return a}function g(){var a=b("gkx")("1418215");a&&b("ScotchRTWebUserActionLogger").logCheckpointOnceForDomain({checkpoint:"gk: rtc_www_state_sync"});return a}function h(){var a;return(a=b("qex")._("1691765"))!=null?a:!1}}),null);
__d("ZenonMWMessageMap",["ZenonMWMessageTypes"],(function(a,b,c,d,e,f){"use strict";d=Object.freeze((a={},a[(c=b("ZenonMWMessageTypes")).ZenonMWSignalingPayloadType.JOIN]="JOIN",a[c.ZenonMWSignalingPayloadType.SERVER_MEDIA_UPDATE]="SERVER_MEDIA_UPDATE",a[c.ZenonMWSignalingPayloadType.ICE_CANDIDATE]="ICE_CANDIDATE",a[c.ZenonMWSignalingPayloadType.HANGUP]="HANGUP",a[c.ZenonMWSignalingPayloadType.RING]="RING",a[c.ZenonMWSignalingPayloadType.DISMISS]="DISMISS",a[c.ZenonMWSignalingPayloadType.CONFERENCE_STATE]="CONFERENCE_STATE",a[c.ZenonMWSignalingPayloadType.ADD_PARTICIPANTS]="ADD_PARTICIPANTS",a[c.ZenonMWSignalingPayloadType.SUBSCRIPTION]="SUBSCRIPTION",a[c.ZenonMWSignalingPayloadType.CLIENT_MEDIA_UPDATE]="CLIENT_MEDIA_UPDATE",a[c.ZenonMWSignalingPayloadType.DATA_MESSAGE]="DATA_MESSAGE",a[c.ZenonMWSignalingPayloadType.REMOVE_PARTICIPANTS]="REMOVE_PARTICIPANTS",a[c.ZenonMWSignalingPayloadType.PING]="PING",a[c.ZenonMWSignalingPayloadType.P2P_PROTOCOL]="P2P_PROTOCOL",a[c.ZenonMWSignalingPayloadType.NOTIFY]="NOTIFY",a[c.ZenonMWSignalingPayloadType.CONNECT]="CONNECT",a[c.ZenonMWSignalingPayloadType.CLIENT_EVENT]="CLIENT_EVENT",a[c.ZenonMWSignalingPayloadType.UNSUBSCRIBE]="UNSUBSCRIBE",a[c.ZenonMWSignalingPayloadType.UPDATE]="UPDATE",a[c.ZenonMWSignalingPayloadType.APPROVAL]="APPROVAL",a));f=d;e.exports=f}),null);
__d("ZenonDebugLogger",["CurrentUser","requireCond","ChannelClientID","FacebookAppIDs","Log","LogHistory","P2PReliabilityTypedLogger","cr:1577681","cr:1577682","RtcInfraReliabilityFalcoEvent","cr:1577683","UserAgentData","ZenonMWMessageMap","ZenonMWMessageTypes","formatDate","recoverableViolation","ScotchRTWebUserActionLogger","$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("CurrentUser").getID(),h=b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType,i=null,j=b("cr:1577683")?{ConnectionStateMachine:b("cr:1577683").CONNECTION_STATE_MACHINE,ParentSignalingClient:b("cr:1577683").PARENT_SIGNALING_CLIENT,PeerConnectionStateMachine:b("cr:1577683").PEER_CONNECTION_STATE_MACHINE,SignalingStateMachine:b("cr:1577683").SIGNALING_STATE_MACHINE}:{},k=b("$InternalEnum").Mirrored(["RECEIVED_REQUEST","PROCESSED_REQUEST","PROCESSED_RESPONSE","SENDING_REQUEST","SENDING_RESPONSE","RECEIVED_RESPONSE"]),l=b("$InternalEnum").Mirrored(["CLIENT_RECEIVED_MESSAGE","CLIENT_PROCESSED_MESSAGE"]);a=function(){a.getInstance=function(){i||(i=new a());return i};function a(){var a;this.$1=b("LogHistory").getInstance("webrtc");this.$2=b("ChannelClientID").getID();this.$3=JSON.stringify({browser:(a=b("UserAgentData")).browserName,browser_version:a.browserFullVersion,device:a.deviceName,msg_source:"web",os:a.platformName,os_version:a.platformFullVersion,version:2});this.$4=b("FacebookAppIDs").MQTT_WEB}var c=a.prototype;c.$5=function(a){var c=b("formatDate")(new Date(),"[H:i:s:X]",{skipPatternLocalization:!0});this.$1.log("Console",c+" "+a);b("ScotchRTWebUserActionLogger").logCheckpoint({checkpoint:"[ZP] "+a},{noConsole:!0})};c.$6=function(a,c,d,e){e===void 0&&(e=0);a=j[a];if(!a||!b("cr:1577682")||!b("cr:1577681"))return;d==="terminated"?b("cr:1577682").markerEnd(a,b("cr:1577681").SUCCESS,e):b("cr:1577682").markerPoint(a,c,{data:{string:{data:d}},instanceKey:e})};c.$7=function(a){return isNaN(+a)?0:+a};c.$8=function(a){a=a.jsonPayload.header;return a.responseStatusCode!=null};c.$9=function(a,c){var d=this,e=c.endpoint,f=c.jsonPayload.header;b("RtcInfraReliabilityFalcoEvent").log(function(){return{client_session_id:f.clientSessionId,conference_name:f.conferenceName,event_name:a,message_type:b("ZenonMWMessageMap")[f.type],retry_count:f.retryCount,server_info_data:f.serverInfoData,tc:Date.now(),transaction_id:f.transactionId,version:"1",web_app_id:+e.appId,web_device_id:d.$2}})};c.$10=function(a){return new(b("P2PReliabilityTypedLogger"))().setServiceName("WEB_CLIENT").setExtra(this.$3).setDeviceID(this.$2).setAppID(this.$4.toString()).setReceiverID(g).setCallID(a.call_id).setMsgID(a.id).setSenderID(a.from).setMsgType(a.type.toUpperCase()||a.msg_type.toUpperCase()).setRawTime(Date.now())};c.logStateMachine=function(a,b,c,d){var e=d==null?a:a+": "+d;e="["+e+"] [Current State: "+b+"] Processing event: "+c;this.$5(e);this.$6(a,c,b,this.$7(d))};c.logMWMessage=function(a,c){if(c.jsonPayload==null)return;var d=c.jsonPayload.header,e=b("ZenonMWMessageMap")[d.type];a="[ms] "+a+" "+e+" [messageID: "+d.transactionId+" retryCount: "+d.retryCount+"]";this.$5(a);this.logMWMessageDetails(c)};c.startQPL=function(a,c){c===void 0&&(c=0),b("cr:1577682")&&b("cr:1577682").markerStart(a,this.$7(c))};c.endQPL=function(a,c){c===void 0&&(c=0),b("cr:1577682")&&b("cr:1577681")&&b("cr:1577682").markerEnd(a,b("cr:1577681").SUCCESS,this.$7(c))};c.logMWMessageDetails=function(a){if(a.jsonPayload==null){b("recoverableViolation")("Should never call logMWMessageDetails with a null jsonPayload message","rtc_www");return}var c=a.jsonPayload,d=c.body;c=c.header;var e=b("ZenonMWMessageMap")[c.type],f="";switch(c.type){case h.SERVER_MEDIA_UPDATE:if(this.$8(a)){f="[md] "+e+" resp [currentVersion: "+((c=(c=d.serverMediaUpdateResponse)==null?void 0:c.currentVersion)!=null?c:"")+"]";break}f="[md] "+e+" req [fromVersion: "+((c=(c=d.serverMediaUpdateRequest)==null?void 0:c.fromVersion)!=null?c:"")+" toVersion: "+((c=(c=d.serverMediaUpdateRequest)==null?void 0:c.toVersion)!=null?c:"")+"]";break;case h.CLIENT_MEDIA_UPDATE:if(this.$8(a)){f="[md] "+e+" resp [currentVersion: "+((a=(c=d.clientMediaUpdateResponse)==null?void 0:c.currentVersion)!=null?a:"")+"]";break}f="[md] "+e+" req [fromVersion: "+((a=(c=d.clientMediaUpdateRequest)==null?void 0:c.fromVersion)!=null?a:"")+" toVersion: "+((a=(c=d.clientMediaUpdateRequest)==null?void 0:c.toVersion)!=null?a:"")+"]";break;case h.SUBSCRIPTION:f="[md] "+e+" req [subscriptions: "+JSON.stringify((a=(c=d.subscriptionRequest)==null?void 0:c.subscriptions)!=null?a:"")+"]";break;default:return}this.$5(f)};c.logReceivingMultiwayMessage=function(a){this.$8(a)?this.$9(k.RECEIVED_RESPONSE,a):this.$9(k.RECEIVED_REQUEST,a)};c.logProcessingMultiwayMessage=function(a){this.$8(a)?this.$9(k.PROCESSED_RESPONSE,a):this.$9(k.PROCESSED_REQUEST,a)};c.logSendingMultiwayMessage=function(a){this.$8(a)?this.$9(k.SENDING_RESPONSE,a):this.$9(k.SENDING_REQUEST,a)};c.logP2PMessageReceived=function(a){this.$10(a).setEventName(l.CLIENT_RECEIVED_MESSAGE).log()};c.logP2PMessageProcessed=function(a){this.$10(a).setEventName(l.CLIENT_PROCESSED_MESSAGE).log()};return a}();e.exports=a}),null);
__d("LazyLoadInstance",["promiseDone"],(function(a,b,c,d,e,f){"use strict";var g={LOADING:1,NOT_READY:0,READY:2};a=function(){function a(a,b){this.$1={instantiate:b,moduleReference:a,stage:g.NOT_READY}}var c=a.prototype;c.get=function(a){switch(this.$1.stage){case g.NOT_READY:b("promiseDone")(this.$2(this.$1),a);break;case g.LOADING:b("promiseDone")(this.$1.instancePromise,a);break;case g.READY:a(this.$1.instance);break}};c.getNow=function(){return this.$1.stage===g.READY?this.$1.instance:null};c.preload=function(){this.$1.stage===g.NOT_READY&&this.$2(this.$1)};c.$2=function(a){var b=this,c=a.instantiate;a=a.moduleReference;a=a.load().then(function(a){a=c(a);b.$1={instance:a,stage:g.READY};return a});this.$1={instancePromise:a,stage:g.LOADING};return a};return a}();e.exports=a}),null);
__d("ZenonSignalingTypes",[],(function(a,b,c,d,e,f){"use strict";a={OK:0,REJECTED_FROM_VERSION_DOES_NOT_MATCH:1};f.ZenonRemoteSdpResponseStatus=a}),null);
__d("ZenonParentSignalingClient",["ZenonDebugLogger","ZenonSignalingTypes","recoverableViolation","unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,c,d,e){var f=this;this.remoteSignalingID=null;this.$4="init";this.$6=null;this.$7=null;this.$8=function(){};this.$9=function(a,c,d){b("ZenonDebugLogger").getInstance().logStateMachine("ParentSignalingClient",f.$4,"received "+a.eventName,f.$1.getSignalingID());switch(a.eventName){case"inviteRequest":f.$11(a,c,d);break;case"remoteSdpRequest":f.$12(a,c);break;case"terminateRequest":f.$13(a,c,d);break}};this.$1=a;this.$3=d;this.$5=e;this.$2=c;c.setReceiver(this.$9);b("ZenonDebugLogger").getInstance().startQPL(64234815,+a.getSignalingID())}var c=a.prototype;c.setSignalingEventHandlers=function(a){if(this.$6!=null){b("recoverableViolation")("setSignalingEventHandlers should only be called once, to avoid accidentally losing handlers.","rtc_www");return}this.$6=a};c.setLoggingEventHandler=function(a){this.$8=a};c.getSignalingModel=function(){return this.$1};c.sendDismiss=function(a){this.$4="terminated";a={eventName:"terminateRequest",fromJoinResponse:!1,reason:a,shouldInformPeer:!0};this.$10(a)};c.receiveMessage=function(a){this.$2.receiveMessage(a)};c.isTerminated=function(){return this.$4==="terminated"};c.sendAnswerIntent=function(){if(this.$4==="inviteAcknowledged"){this.$4="answered";var a={eventName:"answerIntentRequest"};this.$10(a)}else throw b("unrecoverableViolation")("sendAnswerIntent called in unexpected state "+this.$4,"rtc_www")};c.respondToInvite=function(a){if(this.$4==="inviteReceived"){if(this.$7==null)throw b("unrecoverableViolation")("respondToInvite called without inviteMessageId being populated first","rtc_www");this.$4="inviteAcknowledged";a={ackMessageId:this.$7,eventName:"inviteResponse",status:a};this.$10(a)}else throw b("unrecoverableViolation")("respondToInvite called in unexpected state "+this.$4,"rtc_www")};c.sendInvite=function(a,c){throw b("unrecoverableViolation")("sendInvite called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.sendSdp=function(a,c){throw b("unrecoverableViolation")("sendSdp called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.sendIceCandidate=function(a){throw b("unrecoverableViolation")("sendIceCandidate called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.sendMediaUpdate=function(a){throw b("unrecoverableViolation")("sendMediaUpdate called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.sendAddParticipantsMessage=function(a){throw b("unrecoverableViolation")("sendAddParticipantsMessage called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.sendRemoveParticipantsRequest=function(a){throw b("unrecoverableViolation")("sendRemoveParticipantsRequest called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.sendUsersApprovalRequest=function(a,c){throw b("unrecoverableViolation")("sendUsersApprovalRequest called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.sendStateSyncUnsubscribe=function(a){throw b("unrecoverableViolation")("sendStateSyncUnsubscribe called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.sendStateSyncUpdate=function(a,c){throw b("unrecoverableViolation")("sendStateSyncUpdate called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.sendSubscriptionRequest=function(a){throw b("unrecoverableViolation")("sendSubscriptionRequest called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.sendClientInfo=function(a){throw b("unrecoverableViolation")("sendClientInfo called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.sendGenericDataMessage=function(a,c,d){throw b("unrecoverableViolation")("sendGenericDataMessage called on ZenonParentSignalingClient. Did you mean to use ZenonSignalingClient instead?","rtc_www")};c.$10=function(a){b("ZenonDebugLogger").getInstance().logStateMachine("ParentSignalingClient",this.$4,"sending "+a.eventName,this.$1.getSignalingID()),this.$3.sendEvent(a)};c.$11=function(a,b,c){this.$4==="init"&&(this.$4="inviteReceived",this.$7=b,this.$5(a,c,this))};c.$13=function(a,b,c){if(this.$4!=="terminated"){this.$4="terminated";c={ackMessageId:b,eventName:"dismissResponse"};this.$3.sendEvent(c);this.$6&&this.$6.onDismissReceived&&this.$6.onDismissReceived(this.$1.getSignalingID(),a.reason)}};c.$12=function(a,c){c={ackMessageId:c,acknowledgedVersion:a.sdp.version,eventName:"remoteSdpResponse",negotiateType:a.negotiateType,status:b("ZenonSignalingTypes").ZenonRemoteSdpResponseStatus.OK,type:a.sdp.type};this.$3.sendEvent(c)};return a}();e.exports=a}),null);
__d("ZenonParentCallsManager",["regeneratorRuntime","BaseEventEmitter","JSResource","LazyLoadInstance","ZenonCallLogger","ZenonCollisionContext","ZenonDismissReason","ZenonParentCallSummaryLogProcessor","ZenonParentQPLLogProcessor","ZenonParentSignalingClient","gkx","recoverableViolation"],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this)||this;d.$ZenonParentCallsManager4=new Map();d.$ZenonParentCallsManager5=new Set();d.onInviteReceived=function(a,c,e){var f,g=e.getSignalingModel().getSignalingID();e.setSignalingEventHandlers({onDismissReceived:d.onDismissReceived});var h=a.inviterID,i=a.otherParticipants,j=a.requestingVideo;a=a.roomInfo;var k="zenon_incoming_call_dialog",l=d.$ZenonParentCallsManager6({callID:g,callTrigger:k,isCaller:!1,isVideo:j,peerID:h,protocol:c});l.log({name:"inviteReceived"});k=d.$ZenonParentCallsManager3.isSupportedClientForProtocol(c);var m=k?"OK":"NOT_SUPPORTED";e.respondToInvite(m);l.log({name:"inviteResponded"});m={thread:{id:"0",type:2},type:"thread"};if(((f=a.context)==null?void 0:f.groupThreadID)||((f=a.context)==null?void 0:f.peerID)){m={thread:(f=b("ZenonCollisionContext").getThreadIDAndTypeFromCollisionContext(a.context))!=null?f:m.thread,type:"thread"}}else((f=a.room)==null?void 0:f.linkHash)!=null&&((f=a.room)==null?void 0:f.roomName)!=null&&(m={room:a.room,type:"room"});a={context:m,controllerParams:{callContext:a.name,callID:g,configuration:c,serverInfoData:(m=(f=a.context)==null?void 0:f.serverInfoData)!=null?m:null},inviterID:h,isClientPermissableRing:k,onAccept:function(a,b){var f=b.isPopupBlocked;b=b.trigger;l.log({name:"callAccepted",trigger:b});d.$ZenonParentCallsManager2.get(function(a){a.storeOfferForBackwardsCompat(h,g)});e.sendAnswerIntent();d.$ZenonParentCallsManager7(a,{callID:g,callTrigger:b,isPopupBlocked:f,isVideo:j,peerID:h,protocol:c})},onDecline:function(a,b){b===void 0&&(b=null),d.onDecline(g,l,a,b)},otherParticipants:i,requestingVideo:j,ringID:g};d.emit("incomingRing",a)};d.onDismissReceived=function(a,c){var e=b("ZenonDismissReason").dismissReasonToCancelReason(c);e={reason:e,ringID:a};d.emit("ringCancel",e);e=d.$ZenonParentCallsManager4.get(a);e!=null&&(e.log({name:"dismissRecv"}),e.log({endCallReason:c,isRemoteEnded:!0,name:"callEnded"}))};d.$ZenonParentCallsManager3=c;d.$ZenonParentCallsManager2=new(b("LazyLoadInstance"))(b("JSResource")("ZenonSignalingParentTransport").__setRef("ZenonParentCallsManager"),function(a){return new a()});d.$ZenonParentCallsManager1=new(b("LazyLoadInstance"))(b("JSResource")("ZenonSignalingClientManager").__setRef("ZenonParentCallsManager"),function(a){return new a(b("ZenonParentSignalingClient"),d.onInviteReceived)});return d}var d=c.prototype;d.startOutgoingCallIntent=function(a,b){var c=b.callID,d=b.callTrigger,e=b.isVideo,f=b.peerID,g=b.protocol;this.$ZenonParentCallsManager6({callID:c,callTrigger:d,isCaller:!0,isVideo:e,peerID:f,protocol:g});this.$ZenonParentCallsManager7(a,b)};d.$ZenonParentCallsManager6=function(a){var c=a.callID,d=a.callTrigger,e=a.isCaller,f=a.isVideo,g=a.peerID;a=a.protocol;var h=this.$ZenonParentCallsManager4.get(c);!h?(h=new(b("ZenonCallLogger"))({callID:c,callTrigger:d,isCaller:e,isVideo:f,peerID:g,protocol:a},b("gkx")("1536863")?[b("ZenonParentCallSummaryLogProcessor"),b("ZenonParentQPLLogProcessor")]:[b("ZenonParentCallSummaryLogProcessor")]),this.$ZenonParentCallsManager4.set(c,h)):b("recoverableViolation")("Call logger key collision in parentCallsManager for callID: "+c,"rtc_www");return h};d.$ZenonParentCallsManager7=function(a,c){var d,e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:d=c.alohaEscalatedMW,e=c.callID,f=c.isPopupBlocked;this.$ZenonParentCallsManager2.get(function(b){b.verificationNonce=a});this.$ZenonParentCallsManager5.add(e);g=this.$ZenonParentCallsManager4.get(e);if(!(g!=null)){i.next=11;break}g.log({isPopupBlocked:f,name:"popupOpened"});if(!(d!=null)){i.next=11;break}i.next=9;return b("regeneratorRuntime").awrap(d);case 9:h=i.sent,h&&g.log({endCallReason:b("ZenonDismissReason").ZenonDismissReason.OtherInstanceHandled,endCallSubreason:"forceP2POverMWForAloha",isRemoteEnded:!1,name:"callEnded"});case 11:case"end":return i.stop()}},null,this)};d.initListeners=function(a){var b=this;for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;e.subscribe(function(a){return b.onMessageReceived(a)},function(a){return b.onRawP2PMessageReceived(a)},function(a){return b.onRawMWMessageReceived(a)})}};d.onMessageReceived=function(a){var b=a.getHeader().signalingID;if(b!=null&&this.$ZenonParentCallsManager5.has(b))return;this.$ZenonParentCallsManager1.get(function(b){b.receiveMessage(a)})};d.onRawP2PMessageReceived=function(a){this.$ZenonParentCallsManager2.get(function(b){b.enqueueRawP2PMessage(a)})};d.onRawMWMessageReceived=function(a){this.$ZenonParentCallsManager2.get(function(b){b.enqueueRawMWMessage(a)})};d.onDecline=function(a,c,d,e){e===void 0&&(e=null),this.$ZenonParentCallsManager1.get(function(f){f=f.getSignalingClient(a);if(f){var g=b("ZenonDismissReason").endCallToDismissReason(d);d!=="NoAnswerTimeout"&&d!=="VersionUnsupported"&&e!=="CallsBlocked"&&f.sendDismiss(g);c.log({endCallReason:g,endCallSubreason:e,isRemoteEnded:!1,name:"callEnded"})}else b("recoverableViolation")("signaling client should be defined","rtc_www")})};d.removeListeners=function(a){for(var a=a,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;d.unsubscribe()}};return c}(b("BaseEventEmitter"));e.exports=a}),null);
__d("ZenonSignalingMessage",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.getHeader=function(){return this.$1};b.getEvents=function(){return this.$2};b.setSignalingID=function(a){this.$1.signalingID=a};b.setRetryCount=function(a){this.$1.retryCount=a};return a}();e.exports=a}),null);
__d("ZenonMWTranslatorUtils",["ChannelClientID","CurrentUser","FacebookAppIDs","ZenonDismissReason","ZenonMWMessageTypes","ZenonParticipantState","ZenonSignalingTypes","unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";var g={createMWMessage:function(a,c){var d={appId:g.getMWAppID(),deviceId:b("ChannelClientID").getID(),userId:b("CurrentUser").getID()};return{endpoint:d,jsonPayload:{body:c,header:a}}},fromMWDismissReason:function(a){a=b("ZenonDismissReason").mwDismissToDmissReason(a);return(a=a)!=null?a:b("ZenonDismissReason").ZenonDismissReason.CallEnded},fromMWJoinResponseStatusToDismissReason:function(a,c){if(c===b("ZenonMWMessageTypes").ZenonMWResponseSubCode.EXCEEDED_MAX_ALLOWED_PARTICIPANTS)return b("ZenonDismissReason").ZenonDismissReason.MaxAllowedParticipantsReached;switch(a){case b("ZenonMWMessageTypes").ZenonMWResponseStatusCode.METHOD_NOT_ALLOWED:case b("ZenonMWMessageTypes").ZenonMWResponseStatusCode.UNAUTHORIZED:return b("ZenonDismissReason").ZenonDismissReason.NoPermission;case b("ZenonMWMessageTypes").ZenonMWResponseStatusCode.SERVICE_UNAVAILABLE:return b("ZenonDismissReason").ZenonDismissReason.SignalingMessageFailed;case b("ZenonMWMessageTypes").ZenonMWResponseStatusCode.OK:throw b("unrecoverableViolation")("Response status code is OK; should not return a dismiss reason","rtc_www");default:return b("ZenonDismissReason").ZenonDismissReason.ClientError}},fromMWParticipantState:function(a){a=i[a];return(a=a)!=null?a:b("ZenonMWMessageTypes").ZenonMWParticipantCallState.UNKNOWN},getCollisionContextFromAppMessages:function(a){var b=null;a!=null&&a.forEach(function(a){a=(a=a.body)==null?void 0:a.genericMessage;if(a!=null&&a.topic==="collision_context_payload"){a=a.data;if(a!=null){var c;a=JSON.parse(a);b={groupThreadID:(c=a.group_thread_id)!=null?c:null,peerID:(c=a.peer_id)!=null?c:null,serverInfoData:(c=a.server_info_data)!=null?c:null}}}});return b},getMWAppID:function(){return b("FacebookAppIDs").MQTT_WEB.toString()},getRoomMetadataFromAppMessages:function(a){a=a&&a.length>0?a.find(function(a){return((a=a.body)==null?void 0:(a=a.genericMessage)==null?void 0:a.topic)==="room_metadata"}):null;if(a){var b;b=(b=a.body)==null?void 0:(b=b.genericMessage)==null?void 0:b.data;if(b!=null){b=JSON.parse(b);a=(a=a.header)==null?void 0:a.sender;if(b.link_hash!=null&&b.room_name!=null&&a!=null)return{linkHash:b.link_hash,profileURL:b.profile_url,ringSubtitle:b.ring_subtitle,roomName:b.room_name,sender:a}}}return{}},getSdpVersion:function(a){a=a.split("\n");if(a.length<2)throw b("unrecoverableViolation")("Expected SDP string with two or more lines, but got "+a.length,"rtc_www");a=a[1].trim();a=a.split(" ");if(a.length<3)throw b("unrecoverableViolation")("Session line should have at least 3 tokens, but got "+a.length,"rtc_www");a=parseInt(a[2],10);if(isNaN(a))throw b("unrecoverableViolation")("SDP version could not be parsed as number.","rtc_www");return a},mwMessageHeaderToSignalingMessageHeader:function(a){var b=a.clientSessionId,c=a.conferenceName,d=a.sequenceNumber,e=a.serverInfoData,f=a.transactionId;b=b;var g={userID:"2"};f={messageID:f,protocol:"mw",remoteInfo:g,retryCount:a.retryCount,roomInfo:{name:c},sequenceNumber:d,signalingID:b,userInfo:{userID:"1"}};e!=null&&(f.remoteSignalingID=e);return f},signalingMessageHeaderToMWHeader:function(a,b){var c=a.messageID,d=a.remoteSignalingID,e=a.roomInfo,f=a.signalingID;e={conferenceName:e.name,retryCount:a.retryCount,transactionId:c,type:b};f!=null&&(e.clientSessionId=f);d!=null&&(e.serverInfoData=d);return e},signalingMessageHeaderToMWResponseHeader:function(a,c,d){a=g.signalingMessageHeaderToMWHeader(a,c);a.responseStatusCode=(c=d)!=null?c:b("ZenonMWMessageTypes").ZenonMWResponseStatusCode.OK;return a},toMWClientMediaStatus:function(a){var b={tracks:{}};a.tracks.forEach(function(a){b.tracks[a.trackID]={enabled:a.enabled,owner:a.userID}});return b},toMWDeviceStatus:function(a){a=h[a];return(a=a)!=null?a:b("ZenonMWMessageTypes").ZenonMWDeviceStatus.OK},toMWHangupReason:function(a){switch(a){case b("ZenonDismissReason").ZenonDismissReason.IgnoreCall:return b("ZenonMWMessageTypes").ZenonMWHangupReason.IGNORE_CALL;case b("ZenonDismissReason").ZenonDismissReason.HangupCall:return b("ZenonMWMessageTypes").ZenonMWHangupReason.HANGUP_CALL;case b("ZenonDismissReason").ZenonDismissReason.NoAnswerTimeout:return b("ZenonMWMessageTypes").ZenonMWHangupReason.NO_ANSWER_TIMEOUT;case b("ZenonDismissReason").ZenonDismissReason.ClientError:return b("ZenonMWMessageTypes").ZenonMWHangupReason.CLIENT_ERROR;case b("ZenonDismissReason").ZenonDismissReason.InAnotherCall:return b("ZenonMWMessageTypes").ZenonMWHangupReason.IN_ANOTHER_CALL;case b("ZenonDismissReason").ZenonDismissReason.ClientInterrupted:return b("ZenonMWMessageTypes").ZenonMWHangupReason.CLIENT_INTERRUPTED;case b("ZenonDismissReason").ZenonDismissReason.SessionMigrated:return b("ZenonMWMessageTypes").ZenonMWHangupReason.SESSION_MIGRATED;default:return b("ZenonMWMessageTypes").ZenonMWHangupReason.HANGUP_CALL}},toMWMediaStatus:function(a){var b={};a.tracks.forEach(function(a){b[a.trackID]=a.enabled});return b},toMWResponseStatusCode:function(a){return j[a]},toMWSyncStateStore:function(a){var b={};a.forEach(function(a,c){b[c]=a});return b},toZenonMediaStates:function(a){var b={tracks:[],version:0};Object.keys(a.tracks).forEach(function(c){var d=a.tracks[c];c={enabled:d.enabled,trackID:c,userID:d.owner};b.tracks.push(c);b.version++});return b}},h={IN_ANOTHER_CALL:(a=b("ZenonMWMessageTypes")).ZenonMWDeviceStatus.IN_ANOTHER_CALL,NOT_SUPPORTED:a.ZenonMWDeviceStatus.NOT_SUPPORTED,OK:a.ZenonMWDeviceStatus.OK},i=Object.freeze((c={},c[a.ZenonMWParticipantCallState.UNKNOWN]=(d=b("ZenonParticipantState")).ZenonParticipantState.UNKNOWN,c[a.ZenonMWParticipantCallState.DISCONNECTED]=d.ZenonParticipantState.DISCONNECTED,c[a.ZenonMWParticipantCallState.NO_ANSWER]=d.ZenonParticipantState.NO_ANSWER,c[a.ZenonMWParticipantCallState.REJECTED]=d.ZenonParticipantState.REJECTED,c[a.ZenonMWParticipantCallState.UNREACHABLE]=d.ZenonParticipantState.UNREACHABLE,c[a.ZenonMWParticipantCallState.CONNECTION_DROPPED]=d.ZenonParticipantState.CONNECTION_DROPPED,c[a.ZenonMWParticipantCallState.CONTACTING]=d.ZenonParticipantState.CONTACTING,c[a.ZenonMWParticipantCallState.RINGING]=d.ZenonParticipantState.RINGING,c[a.ZenonMWParticipantCallState.CONNECTING]=d.ZenonParticipantState.CONNECTING,c[a.ZenonMWParticipantCallState.CONNECTED]=d.ZenonParticipantState.CONNECTED,c[a.ZenonMWParticipantCallState.PARTICIPANT_LIMIT_REACHED]=d.ZenonParticipantState.PARTICIPANT_LIMIT_REACHED,c[a.ZenonMWParticipantCallState.IN_ANOTHER_CALL]=d.ZenonParticipantState.IN_ANOTHER_CALL,c[a.ZenonMWParticipantCallState.RING_TYPE_UNSUPPORTED]=d.ZenonParticipantState.RING_TYPE_UNSUPPORTED,c[a.ZenonMWParticipantCallState.PENDING_APPROVAL]=d.ZenonParticipantState.PENDING_APPROVAL,c[a.ZenonMWParticipantCallState.APPROVED]=d.ZenonParticipantState.APPROVED,c[a.ZenonMWParticipantCallState.FAILED_APPROVAL]=d.ZenonParticipantState.FAILED_APPROVAL,c)),j=Object.freeze((f={},f[b("ZenonSignalingTypes").ZenonRemoteSdpResponseStatus.OK]=a.ZenonMWResponseStatusCode.OK,f[b("ZenonSignalingTypes").ZenonRemoteSdpResponseStatus.REJECTED_FROM_VERSION_DOES_NOT_MATCH]=a.ZenonMWResponseStatusCode.CONDITIONAL_REQUEST_FAILED,f));d=g;e.exports=d}),null);
__d("ZenonMWMessageTranslator",["CurrentUser","ScotchRTWebUserActionLogger","ZenonMWMessageTypes","ZenonMWTranslatorUtils","ZenonSignalingMessage","gkx","qex","unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";f.toMWMessage=a;f.toSignalingMessage=c;var g="joining_context",h="signalingDominantSpeakerUpdate";function a(a){var c=a.getHeader();a=a.getEvents();if(a.length===0)throw b("unrecoverableViolation")("Unexpected Translation: called toMWMessage with empty signaling events","messenger_web_product");else{var d=a[0];switch(d.eventName){case"addParticipantsRequest":return w(c,d);case"clientInfoRequest":if(a.length>=2&&a[1].eventName==="localSdpRequest"&&(a[1].sdp.type==="offer"||a[1].sdp.type==="answer"&&P()))return B(c,d,a[1]);break;case"genericDataMessageRequest":return y(c,d);case"inviteRequest":if(a.length>=3&&a[1].eventName==="clientInfoRequest"&&a[2].eventName==="localSdpRequest"&&a[2].sdp.type==="offer")return B(c,a[1],a[2],d);break;case"inviteResponse":return C(c,d);case"dismissResponse":return G(c);case"initiateRenegotiationResponse":return L(c,d);case"iceCandidateRequest":return A(c,d);case"iceCandidateResponse":return z(c,d);case"localSdpRequest":return J(c,d.mediaStates,d.sdp);case"mediaUpdateRequest":return J(c,d.mediaStates);case"participantUpdateResponse":return I(c,d);case"pingRequest":return H(c);case"remoteSdpResponse":return d.type==="offer"&&(a.length>=2&&a[1].eventName==="localSdpRequest"&&a[1].sdp.type==="answer")?K(c,d,a[1]):K(c,d);case"removeParticipantsRequest":return x(c,d);case"stateSyncNotifyResponse":return N(c,d);case"stateSyncUnsubscribeRequest":return O(c,d);case"stateSyncUpdateRequest":return M(c,d);case"subscriptionRequest":return E(c,d);case"terminateRequest":return D(c,d);case"usersApprovalRequest":return F(c,d)}}return null}function c(a){var c=a.jsonPayload.header;if(c.receiverUserId!=null&&c.receiverUserId!==b("CurrentUser").getID())throw b("unrecoverableViolation")("Ignoring MW message; receiverUserId does not match self ID","messenger_web_product");var d=c.type,e=c.responseStatusCode==null;c=b("ZenonMWTranslatorUtils").mwMessageHeaderToSignalingMessageHeader(c);var f=[];switch(d){case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.RING:e&&(f=k(a));break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DISMISS:e&&(f=l(a));break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.JOIN:e||(f=n(a));break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ICE_CANDIDATE:e?f=o(a):f=p(a);break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CONFERENCE_STATE:e&&(f=q(a));break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CLIENT_MEDIA_UPDATE:e||(f=r(a));break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.SERVER_MEDIA_UPDATE:e&&(f=s(a));break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.PING:e||(f=i(a));break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.HANGUP:e||(f=j(a));break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DATA_MESSAGE:e&&(f=m(a));break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.UPDATE:e||(f=t(a));break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.UNSUBSCRIBE:e||(f=v(a));break;case b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.NOTIFY:e&&(f=u(a));break}return new(b("ZenonSignalingMessage"))(c,f)}function i(a){var b=[];a=a.jsonPayload.header;a={ackMessageId:a.transactionId,eventName:"pingResponse"};b.push(a);return b}function j(a){var b=[];a=a.jsonPayload.header;a={ackMessageId:a.transactionId,eventName:"hangupResponse"};b.push(a);return b}function k(a){var c=[];a=a.jsonPayload;var d=a.body;a=a.header;d=d.ringRequest;if(d){var e=d.appMessages,f=d.caller,g=d.otherParticipants,h=d.ringType;f=f;h=h===b("ZenonMWMessageTypes").ZenonMWRingType.PEER_VIDEO_CALL||h===b("ZenonMWMessageTypes").ZenonMWRingType.GROUP_VIDEO_CALL||h===b("ZenonMWMessageTypes").ZenonMWRingType.LIVE_STREAM||h===b("ZenonMWMessageTypes").ZenonMWRingType.PEER_ESCALATED_AUDIO_CALL;var i=a.conferenceName;a=a.serverInfoData;var j=b("ZenonMWTranslatorUtils").getCollisionContextFromAppMessages(e);j&&(j==null?void 0:j.serverInfoData)==null&&(j.serverInfoData=a);e=b("ZenonMWTranslatorUtils").getRoomMetadataFromAppMessages(e);g={eventName:"inviteRequest",inviterID:f,isRemoteOfferer:!1,otherParticipants:g,requestingVideo:h,roomInfo:{context:(f=j)!=null?f:{groupThreadID:null,peerID:null,serverInfoData:a},name:i,room:e,sender:e.sender}};c.push(g);f=(j=(h=d.offer)==null?void 0:h.sdpString)!=null?j:"";i=(a=d.mediaStatusEx)!=null?a:null;if(f!==""&&i!=null&&P()){e={sdp:f,type:"offer",version:b("ZenonMWTranslatorUtils").getSdpVersion(f)};g=b("ZenonMWTranslatorUtils").toZenonMediaStates(i);h={eventName:"remoteSdpRequest",mediaStates:g,negotiateType:!1,sdp:e};c.push(h)}}return c}function l(a){var c=[];a=a.jsonPayload.body.dismissRequest;if(a){a=a.reason;a={eventName:"terminateRequest",fromJoinResponse:!1,reason:b("ZenonMWTranslatorUtils").fromMWDismissReason(a),shouldInformPeer:!0};c.push(a)}return c}function m(a){var b=[];a=a.jsonPayload.body.dataMessageRequest;if(a){var c,d=a.message.header;c=(c=a.message)==null?void 0:(c=c.body)==null?void 0:c.genericMessage;a=(a=a.message)==null?void 0:(a=a.body)==null?void 0:a.dominantSpeakerSignalingInfo;if(c||a){a=c?atob(c.data):JSON.stringify(a);c=c?c.topic:h;d={data:(a=a)!=null?a:"",eventName:"genericDataMessageRequest",recipientIDs:(a=d.recipients)!=null?a:[],serviceRecipients:(a=d.serviceRecipients)!=null?a:[],topic:c};b.push(d)}}return b}function n(a){var c=[],d=a.jsonPayload.header;if(d.responseStatusCode&&d.responseStatusCode!==b("ZenonMWMessageTypes").ZenonMWResponseStatusCode.OK){var e={eventName:"terminateRequest",fromJoinResponse:!0,reason:b("ZenonMWTranslatorUtils").fromMWJoinResponseStatusToDismissReason(d.responseStatusCode,d.responseSubCode),shouldInformPeer:!1};c.push(e);return c}e=a.jsonPayload.body.joinResponse;if(!e)return c;a=(a=(a=e.answer)==null?void 0:a.sdpString)!=null?a:"";var f=a!=="";d={ackMessageId:d.transactionId,eventName:"localSdpResponse",hasAnswerInJoinResponse:f,source:"joinResponse"};c.push(d);if(f){d={sdp:a,type:"answer",version:b("ZenonMWTranslatorUtils").getSdpVersion(a)};f=b("ZenonMWTranslatorUtils").toZenonMediaStates(e.mediaStatusEx);a={eventName:"remoteSdpRequest",mediaStates:f,negotiateType:!1,sdp:d,source:"joinResponse"};c.push(a)}f={capabilities:{addParticipantEnabled:!0},eventName:"capabilitiesRequest"};c.push(f);var g=e.stateStore;Q()&&g&&Object.keys(g).forEach(function(a){var b=g[a],d=b.data;b=b.version;if(d!=null){d={data:d,eventName:"stateSyncNotifyRequest",responseRequired:!1,topic:a,version:b};c.push(d)}});if(R()&&e.isPendingApproval){d={eventName:"pendingApprovalRequest"};c.push(d)}return c}function o(a){var b=[];a=a.jsonPayload.body.iceCandidateRequest;if(a){a={eventName:"iceCandidateRequest",iceCandidates:a.iceCandidateSdps.map(function(a){var b;return{candidateSdpString:(b=a.candidateSdpString)!=null?b:"",sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid}})};b.push(a)}return b}function p(a){var b=[];a=a.jsonPayload.header;a={ackMessageId:a.transactionId,eventName:"iceCandidateResponse"};b.push(a);return b}function q(a){var c=[];a=a.jsonPayload.body.conferenceStateRequest;if(a){var d=a.appMessages,e=a.participantStates,f={eventName:"participantUpdateRequest",participantStates:new Map(),versionId:a.version},g={eventName:"clientInfoRequest",userCapabilities:new Map()};Object.keys(e).forEach(function(a){var c=e[a],d=c.state;c=c.userCapabilities;f.participantStates.set(a,b("ZenonMWTranslatorUtils").fromMWParticipantState(d));g.userCapabilities.set(a,(d=c)!=null?d:"")});c.push(f);c.push(g);a=b("ZenonMWTranslatorUtils").getCollisionContextFromAppMessages(d);if(a){d={context:a,eventName:"roomContextUpdateRequest"};c.push(d)}}return c}function r(a){var c=[];a=a.jsonPayload;var d=a.body;a=a.header;d=d.clientMediaUpdateResponse;var e=a.responseSubCode,f=a.retryAfterMsec;if(d){var g=d.answer,h=d.mediaStatus;if(g!=null&&h!=null){g=(g=g.sdpString)!=null?g:"";h=b("ZenonMWTranslatorUtils").toZenonMediaStates(h);var i={ackMessageId:a.transactionId,eventName:"localSdpResponse",hasAnswerInJoinResponse:!1,source:"clientMediaUpdate"};h={eventName:"remoteSdpRequest",mediaStates:h,negotiateType:!1,sdp:{sdp:g,type:"answer",version:b("ZenonMWTranslatorUtils").getSdpVersion(g)}};c.push(i);c.push(h)}else{g={ackMessageId:a.transactionId,eventName:"mediaUpdateResponse",requestVersionId:d.currentVersion,responseSubCode:e,retryAfter:f};c.push(g)}}return c}function s(a){var c=[];a=a.jsonPayload;var d=a.body;a=a.header;d=d.serverMediaUpdateRequest;if(!d)return c;a={eventName:"overlayConfigServerUpdateRequest",serializedConfig:(a=(a=a.extensions)==null?void 0:a.oc1)!=null?a:""};c.push(a);if(d.renegotiationRequested){a={eventName:"initiateRenegotiationRequest",fromVersion:d.fromVersion,version:d.toVersion};c.push(a)}a=(a=(a=d.answer)==null?void 0:a.sdpString)!=null?a:"";var e="answer";if(a===""){var f;a=(f=(f=d.offer)==null?void 0:f.sdpString)!=null?f:"";e="offer"}if(a==="")return c;f={sdp:a,type:e,version:b("ZenonMWTranslatorUtils").getSdpVersion(a)};e=b("ZenonMWTranslatorUtils").toZenonMediaStates(d.mediaStatus);a={eventName:"remoteSdpRequest",fromVersion:d.fromVersion,mediaStates:e,negotiateType:!1,sdp:f};c.push(a);return c}function t(a){a=a.jsonPayload;var b=a.body.updateResponse;a=a.header.transactionId;if(!b)return[];var c=b.topic;b=b.version;a={ackMessageId:a,eventName:"stateSyncUpdateResponse",topic:c,version:b};return[a]}function u(a){a=a.jsonPayload.body.notifyRequest;if(!a)return[];var b=a.data,c=a.topic;a=a.version;b={data:b,eventName:"stateSyncNotifyRequest",responseRequired:!0,topic:c,version:a};return[b]}function v(a){a=a.jsonPayload;var b=a.body.unsubscribeResponse;a=a.header.transactionId;if(!b)return[];var c=b.topic;b=b.version;a={ackMessageId:a,eventName:"stateSyncUnsubscribeResponse",topic:c,version:b};return[a]}function w(a,c){c={usersToInvite:c.participants};a=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ADD_PARTICIPANTS);return b("ZenonMWTranslatorUtils").createMWMessage(a,{addParticipantsRequest:c})}function x(a,c){c={usersToRemove:c.participants};a=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.REMOVE_PARTICIPANTS);return b("ZenonMWTranslatorUtils").createMWMessage(a,{removeParticipantsRequest:c})}function y(a,c){var d={data:c.data,topic:c.topic};a=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DATA_MESSAGE);return b("ZenonMWTranslatorUtils").createMWMessage(a,{dataMessageRequest:{message:{body:{genericMessage:d},header:{recipients:c.recipientIDs,sender:b("CurrentUser").getID(),serviceRecipients:c.serviceRecipients,topic_DEPRECATED:""}}}})}function z(a,c){c=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ICE_CANDIDATE);return b("ZenonMWTranslatorUtils").createMWMessage(c,{})}function A(a,c){c=c.iceCandidates;c=c.map(function(a){return{candidateSdpString:a.candidateSdpString,sdpMLineIndex:a.sdpMLineIndex,sdpMid:a.sdpMid}});c={iceCandidateSdps:c};a=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.ICE_CANDIDATE);return b("ZenonMWTranslatorUtils").createMWMessage(a,{iceCandidateRequest:c})}function B(a,c,d,e){var f=c.initialSyncStates;f={deviceCapabilities:[b("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_NEW_PARTICIPANT_STATES,b("ZenonMWMessageTypes").ZenonMWCapability.REQUIRE_FULL_SDP_IN_SMU,b("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_SDP_RENEGOTIATION],mediaStatus:b("ZenonMWTranslatorUtils").toMWMediaStatus(d.mediaStates),offer:{},syncPayload:f?{stateStore:b("ZenonMWTranslatorUtils").toMWSyncStateStore(f)}:void 0,userCapabilities:c.userCapabilities.get(a.userInfo.userID)};d.sdp.type==="offer"&&(f.offer={sdpString:d.sdp.sdp});P()&&(f.deviceCapabilities.push(b("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_MWPP),d.sdp.type==="answer"&&(f.answer={sdpString:d.sdp.sdp}));c=e==null?void 0:e.otherParticipants;c&&(f.usersToCall=c);c=(d=e==null?void 0:e.roomInfo.context)!=null?d:a.roomInfo.context;c&&(f.appMessages=[{body:{genericMessage:{data:JSON.stringify(c),topic:g}},header:{topic_DEPRECATED:g}}]);e=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.JOIN);c&&c.serverInfoData!=null&&(e.serverInfoData=c.serverInfoData);return b("ZenonMWTranslatorUtils").createMWMessage(e,{joinRequest:f})}function C(a,c){c=c.status;c==="IN_ANOTHER_CALL"&&(a.signalingID=null);c=b("ZenonMWTranslatorUtils").toMWDeviceStatus(c);c={deviceCapabilities:[b("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_AUDIO_DEPRECATED,b("ZenonMWMessageTypes").ZenonMWCapability.SUPPORT_VIDEO_DEPRECATED],deviceStatus:c};a=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.RING);return b("ZenonMWTranslatorUtils").createMWMessage(a,{ringResponse:c})}function D(a,c){c=c.reason;c={detailedReasonString:"",reason:b("ZenonMWTranslatorUtils").toMWHangupReason(c)};a=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.HANGUP);return b("ZenonMWTranslatorUtils").createMWMessage(a,{hangupRequest:c})}function E(a,c){c=c.subscriptions;c={subscriptions:c};a=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.SUBSCRIPTION);return b("ZenonMWTranslatorUtils").createMWMessage(a,{subscriptionRequest:c})}function F(a,c){var d=c.approvalStatus;c=c.targetUsers;d={approvalStatus:d,targetUsers:c};c=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.APPROVAL);return b("ZenonMWTranslatorUtils").createMWMessage(c,{approvalRequest:d})}function G(a){a=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.DISMISS);return b("ZenonMWTranslatorUtils").createMWMessage(a,{})}function H(a){var c=Object.freeze({});a=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.PING);return b("ZenonMWTranslatorUtils").createMWMessage(a,{pingRequest:c})}function I(a,c){c={currentVersion:c.requestVersionId};a=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CONFERENCE_STATE);return b("ZenonMWTranslatorUtils").createMWMessage(a,{conferenceStateResponse:c})}function J(a,c,d){c={fromVersion:c.version,mediaUpdates:[{mediaStatus:b("ZenonMWTranslatorUtils").toMWMediaStatus(c)}],toVersion:c.version};d!==void 0&&(c.offer={sdpString:d.sdp});d=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.CLIENT_MEDIA_UPDATE);return b("ZenonMWTranslatorUtils").createMWMessage(d,{clientMediaUpdateRequest:c})}function K(a,c,d){if(c.acknowledgedVersion==null)throw b("unrecoverableViolation")("Error creating ServerMediaUpdateResponse: remoteSdpResponse.acknowledgedVersion is null","messenger_web_product");var e={currentVersion:c.acknowledgedVersion};d&&(e.answer={sdpString:d.sdp.sdp},e.mediaStatus=b("ZenonMWTranslatorUtils").toMWClientMediaStatus(d.mediaStates));d=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.SERVER_MEDIA_UPDATE,b("ZenonMWTranslatorUtils").toMWResponseStatusCode(c.status));return b("ZenonMWTranslatorUtils").createMWMessage(d,{serverMediaUpdateResponse:e})}function L(a,c){var d={currentVersion:c.acknowledgedVersion};a=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.SERVER_MEDIA_UPDATE,b("ZenonMWTranslatorUtils").toMWResponseStatusCode(c.status));return b("ZenonMWTranslatorUtils").createMWMessage(a,{serverMediaUpdateResponse:d})}function M(a,c){var d=c.data,e=c.topic;c=c.version;d={data:d,topic:e,version:c};e=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.UPDATE);return b("ZenonMWTranslatorUtils").createMWMessage(e,{updateRequest:d})}function N(a,c){var d=c.topic;c=c.version;d={topic:d,version:c};c=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWResponseHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.NOTIFY);return b("ZenonMWTranslatorUtils").createMWMessage(c,{notifyResponse:d})}function O(a,c){var d=c.topic;c=c.version;d={topic:d,version:c};c=b("ZenonMWTranslatorUtils").signalingMessageHeaderToMWHeader(a,b("ZenonMWMessageTypes").ZenonMWSignalingPayloadType.UNSUBSCRIBE);return b("ZenonMWTranslatorUtils").createMWMessage(c,{unsubscribeRequest:d})}function P(){var a;return(a=b("qex")._("1566745"))!=null?a:!1}function Q(){var a=b("gkx")("1418215");a&&b("ScotchRTWebUserActionLogger").logCheckpointOnceForDomain({checkpoint:"gk: rtc_www_state_sync"});return a}function R(){var a=b("gkx")("1450329");a&&b("ScotchRTWebUserActionLogger").logCheckpointOnceForDomain({checkpoint:"gk: rtc_www_lobby_mode"});return a}}),null);
__d("CallEndReason",[],(function(a,b,c,d,e,f){a=Object.freeze({IGNORE_CALL:"IgnoreCall",HANGUP_CALL:"HangupCall",IN_ANOTHER_CALL:"InAnotherCall",ACCEPT_AFTER_HANGUP:"CallEndAcceptAfterHangUp",NO_ANSWER_TIMEOUT:"NoAnswerTimeout",INCOMING_TIMEOUT:"IncomingTimeout",OTHER_INSTANCE_HANDLED:"OtherInstanceHandled",SIGNALING_MESSAGE_FAILED:"SignalingMessageFailed",CONNECTION_DROPPED:"ConnectionDropped",CLIENT_INTERRUPTED:"ClientInterrupted",WEBRTC_ERROR:"WebRTCError",CLIENT_ERROR:"ClientError",NO_PERMISSION:"NoPermission",OTHER_NOT_CAPABLE:"OtherNotCapable",NO_UI_ERROR:"NoUIShown",UNSUPPORTED_VERSION:"VersionUnsupported",CALLER_NOT_VISIBLE:"CallerNotVisible",CARRIER_BLOCKED:"CarrierBlocked",OTHER_CARRIER_BLOCKED:"OtherCarrierBlocked",CLIENT_ENCRYPTION_ERROR:"ClientEncryptionError"});e.exports=a}),null);
__d("WebrtcMessageType",[],(function(a,b,c,d,e,f){a=Object.freeze({OFFER:"offer",ANSWER:"answer",ICE_CANDIDATE:"ice_candidate",OK:"ok",HANG_UP:"hang_up",OTHER_DISMISS:"other_dismiss",MESSAGE_ACK:"msg_ack",PRANSWER:"pranswer",PING:"ping",PING_ACK:"ping_ack",ICE_RESTART_OFFER:"icerestart_offer",ICE_RESTART_ANSWER:"icerestart_answer",OFFER_ACK:"offer_ack",ANSWER_ACK:"answer_ack",SET_VIDEO:"set_video",ACK:"ack",INVALID:"invalid",OFFER_NACK:"offer_nack",NACK:"nack",VIDEO_REQUEST:"video_request",SDP_UPDATE:"sdp_update",SWITCH_TO_MULTIWAY:"switch_to_multiway",ON_HOLD:"on_hold",NEGOTIATE:"negotiate",RING:"ring",PR_OFFER_ACK:"pr_offer_ack",NOTIFY_MEDIA_STATE:"notify_media_state",CLIENT_REPORTED_EVENT:"client_reported_event"});e.exports=a}),null);
__d("ZenonP2PMessageTypes",["WebrtcMessageType","CallEndReason"],(function(a,b,c,d,e,f){"use strict";a=b("CallEndReason");f.ZenonP2PCallEndReason=a;c=b("WebrtcMessageType");f.ZenonP2PSignalingPayloadType=c}),null);
__d("ZenonP2PTranslatorUtils",["CurrentUser","ZenonDismissReason","ZenonP2PMessageTypes"],(function(a,b,c,d,e,f){"use strict";f.fromP2PCallEndReason=a;f.p2pMessageToSignalingMessageHeader=c;f.toP2PCallEndReason=d;function a(a){a=g[a];return(a=a)!=null?a:b("ZenonDismissReason").ZenonDismissReason.CallEnded}function c(a,c){var d=c.call_id,e=c.from;c=c.source;var f=e+":"+b("CurrentUser").getID();return{messageID:a,protocol:"p2p",remoteInfo:{deviceInfo:{deviceID:c},userID:e},remoteSignalingID:String(d),retryCount:0,roomInfo:{name:f},signalingID:String(d),userInfo:{userID:b("CurrentUser").getID()}}}function d(a){switch(a){case b("ZenonDismissReason").ZenonDismissReason.HangupCall:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.HANGUP_CALL;case b("ZenonDismissReason").ZenonDismissReason.IgnoreCall:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.IGNORE_CALL;case b("ZenonDismissReason").ZenonDismissReason.InAnotherCall:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.IN_ANOTHER_CALL;case b("ZenonDismissReason").ZenonDismissReason.AcceptAfterHangUp:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.ACCEPT_AFTER_HANGUP;case b("ZenonDismissReason").ZenonDismissReason.NoAnswerTimeout:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.NO_ANSWER_TIMEOUT;case b("ZenonDismissReason").ZenonDismissReason.IncomingTimeout:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.INCOMING_TIMEOUT;case b("ZenonDismissReason").ZenonDismissReason.OtherInstanceHandled:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.OTHER_INSTANCE_HANDLED;case b("ZenonDismissReason").ZenonDismissReason.SignalingMessageFailed:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.SIGNALING_MESSAGE_FAILED;case b("ZenonDismissReason").ZenonDismissReason.ConnectionDropped:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CONNECTION_DROPPED;case b("ZenonDismissReason").ZenonDismissReason.ClientInterrupted:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CLIENT_INTERRUPTED;case b("ZenonDismissReason").ZenonDismissReason.WebRTCError:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.WEBRTC_ERROR;case b("ZenonDismissReason").ZenonDismissReason.ClientError:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CLIENT_ERROR;case b("ZenonDismissReason").ZenonDismissReason.NoPermission:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.NO_PERMISSION;case b("ZenonDismissReason").ZenonDismissReason.OtherNotCapable:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.OTHER_NOT_CAPABLE;case b("ZenonDismissReason").ZenonDismissReason.NoUIShown:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.NO_UI_ERROR;case b("ZenonDismissReason").ZenonDismissReason.VersionUnsupported:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.UNSUPPORTED_VERSION;case b("ZenonDismissReason").ZenonDismissReason.CallerNotVisible:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CALLER_NOT_VISIBLE;case b("ZenonDismissReason").ZenonDismissReason.CarrierBlocked:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CARRIER_BLOCKED;case b("ZenonDismissReason").ZenonDismissReason.OtherCarrierBlocked:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.OTHER_CARRIER_BLOCKED;case b("ZenonDismissReason").ZenonDismissReason.ClientEncryptionError:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.CLIENT_ENCRYPTION_ERROR;default:return b("ZenonP2PMessageTypes").ZenonP2PCallEndReason.HANGUP_CALL}}var g=Object.freeze((e={},e[(a=b("ZenonP2PMessageTypes")).ZenonP2PCallEndReason.HANGUP_CALL]=(c=b("ZenonDismissReason")).ZenonDismissReason.HangupCall,e[a.ZenonP2PCallEndReason.IGNORE_CALL]=c.ZenonDismissReason.IgnoreCall,e[a.ZenonP2PCallEndReason.IN_ANOTHER_CALL]=c.ZenonDismissReason.InAnotherCall,e[a.ZenonP2PCallEndReason.ACCEPT_AFTER_HANGUP]=c.ZenonDismissReason.AcceptAfterHangUp,e[a.ZenonP2PCallEndReason.NO_ANSWER_TIMEOUT]=c.ZenonDismissReason.NoAnswerTimeout,e[a.ZenonP2PCallEndReason.INCOMING_TIMEOUT]=c.ZenonDismissReason.IncomingTimeout,e[a.ZenonP2PCallEndReason.OTHER_INSTANCE_HANDLED]=c.ZenonDismissReason.OtherInstanceHandled,e[a.ZenonP2PCallEndReason.SIGNALING_MESSAGE_FAILED]=c.ZenonDismissReason.SignalingMessageFailed,e[a.ZenonP2PCallEndReason.CONNECTION_DROPPED]=c.ZenonDismissReason.ConnectionDropped,e[a.ZenonP2PCallEndReason.CLIENT_INTERRUPTED]=c.ZenonDismissReason.ClientInterrupted,e[a.ZenonP2PCallEndReason.CLIENT_ERROR]=c.ZenonDismissReason.ClientError,e[a.ZenonP2PCallEndReason.WEBRTC_ERROR]=c.ZenonDismissReason.WebRTCError,e[a.ZenonP2PCallEndReason.CLIENT_ERROR]=c.ZenonDismissReason.ClientError,e[a.ZenonP2PCallEndReason.NO_PERMISSION]=c.ZenonDismissReason.NoPermission,e[a.ZenonP2PCallEndReason.OTHER_NOT_CAPABLE]=c.ZenonDismissReason.OtherNotCapable,e[a.ZenonP2PCallEndReason.NO_UI_ERROR]=c.ZenonDismissReason.NoUIShown,e[a.ZenonP2PCallEndReason.UNSUPPORTED_VERSION]=c.ZenonDismissReason.VersionUnsupported,e[a.ZenonP2PCallEndReason.CALLER_NOT_VISIBLE]=c.ZenonDismissReason.CallerNotVisible,e[a.ZenonP2PCallEndReason.CARRIER_BLOCKED]=c.ZenonDismissReason.CarrierBlocked,e[a.ZenonP2PCallEndReason.OTHER_CARRIER_BLOCKED]=c.ZenonDismissReason.OtherCarrierBlocked,e[a.ZenonP2PCallEndReason.CLIENT_ENCRYPTION_ERROR]=c.ZenonDismissReason.ClientEncryptionError,e))}),null);
__d("ZenonP2PMessageTranslator",["errorCode","ZenonDismissReason","ZenonP2PMessageTypes","ZenonP2PTranslatorUtils","ZenonParticipantState","ZenonSignalingMessage"],(function(a,b,c,d,e,f,g){"use strict";f.toP2PMessage=a;f.toSignalingMessage=c;var h=0,i=3;function a(a){var b=a.getHeader();a=a.getEvents();if(a.length===0)throw new Error("Unexpected Translation: called toP2PMessage with empty signaling events");switch(a[0].eventName){case"answerIntentRequest":return q(b);case"inviteResponse":if(a[0].status==="NOT_SUPPORTED")return o(b);else return n(b);case"terminateRequest":return p(b,a[0]);default:return null}}function c(a){switch(a.type){case b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OFFER:return j(a);case b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.HANG_UP:return k(a);case b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OTHER_DISMISS:return l(a);case b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.ICE_CANDIDATE:return m(a);default:return null}}function j(a){var c=b("ZenonP2PTranslatorUtils").p2pMessageToSignalingMessageHeader(String(a.msg_id),a),d=[],e=a.escalation_conference_name,f=a.from,g=a.videoon;g={eventName:"inviteRequest",inviterID:f,isRemoteOfferer:!0,otherParticipants:[],requestingVideo:g,roomInfo:{context:{groupThreadID:null,peerID:f,serverInfoData:null},name:e}};d.push(g);e={eventName:"remoteSdpRequest",sdp:{sdp:a.sdp,type:"offer",version:0},mediaStates:{tracks:[],version:0},negotiateType:!1};d.push(e);g={capabilities:{addParticipantEnabled:a.offer_escalation_support},eventName:"capabilitiesRequest"};d.push(g);e=new Map([[f,b("ZenonParticipantState").ZenonParticipantState.CONNECTED]]);a={eventName:"participantUpdateRequest",participantStates:e,versionId:h};d.push(a);return new(b("ZenonSignalingMessage"))(c,d)}function k(a){var c=b("ZenonP2PTranslatorUtils").p2pMessageToSignalingMessageHeader(String(a.msg_id),a),d=[],e=a.from;a=a.reason;a={eventName:"terminateRequest",fromJoinResponse:!1,reason:b("ZenonP2PTranslatorUtils").fromP2PCallEndReason(a),shouldInformPeer:!0};d.push(a);a=new Map([[e,b("ZenonParticipantState").ZenonParticipantState.DISCONNECTED]]);e={eventName:"participantUpdateRequest",participantStates:a,versionId:i};d.push(e);return new(b("ZenonSignalingMessage"))(c,d)}function l(a){a=b("ZenonP2PTranslatorUtils").p2pMessageToSignalingMessageHeader(String(a.msg_id),a);var c=[],d={eventName:"terminateRequest",fromJoinResponse:!1,reason:b("ZenonDismissReason").ZenonDismissReason.OtherInstanceHandled,shouldInformPeer:!0};c.push(d);return new(b("ZenonSignalingMessage"))(a,c)}function m(a){var c=b("ZenonP2PTranslatorUtils").p2pMessageToSignalingMessageHeader(String(a.msg_id),a),d=[],e=a.sdp,f=a.sdp_line_idx;a=a.sdp_mid;e={candidateSdpString:e,sdpMLineIndex:f,sdpMid:a};f={eventName:"iceCandidateRequest",iceCandidates:[e]};d.push(f);return new(b("ZenonSignalingMessage"))(c,d)}function n(a){if(a.signalingID===null)throw new Error("Unexpected P2P Translation: expected signalingID to not be null");return{ack_id:parseInt(a.messageID,10),call_id:parseInt(a.signalingID,10),msg_id:parseInt(a.messageID,10),type:"offer_ack"}}function o(a){if(a.signalingID===null)throw new Error("Unexpected P2P Translation: expected signalingID to not be null");return{ack_id:parseInt(a.messageID,10),call_id:parseInt(a.signalingID,10),error_code:1356043,msg_id:parseInt(a.messageID,10),type:"offer_nack"}}function p(a,c){if(a.signalingID===null)throw new Error("Unexpected P2P Translation: expected signalingID to not be null");var d=parseInt(a.messageID,10);a=parseInt(a.signalingID,10);c=b("ZenonP2PTranslatorUtils").toP2PCallEndReason(c.reason);return{call_id:a,msg_id:d,reason:c,type:"hang_up",version:0}}function q(a){if(a.signalingID===null)throw new Error("Unexpected P2P Translation: expected signalingID to not be null");var b=parseInt(a.signalingID,10);a=parseInt(a.messageID,10);return{call_id:b,msg_id:a,type:"other_dismiss"}}}),null);
__d("ZenonP2PMessageValidator",["CurrentUser","ZenonP2PMessageTypes","err"],(function(a,b,c,d,e,f){"use strict";f.getValidP2PMessage=a;f.transformP2PMessage=c;function a(a){a=JSON.parse(a);var c=a.call_id,d=a.from,e=a.id,f=a.msg_type,g=a.payload,h=a.source,i=a.to;a=a.type;if(i!=null&&i!==b("CurrentUser").getID())throw b("err")("P2P message.to field does not match logged in user ID");if(d&&c&&g){i={call_id:c,from:d,id:e,msg_type:f,payload:g,source:h,type:a};return i}else throw b("err")("P2P message does not have valid from, call_id, and payload fields")}function c(a){if(a){var c=a.msg_type;switch(c){case b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OFFER:return h(a);case b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.HANG_UP:return i(a);case b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.ICE_CANDIDATE:return g(a);case b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OTHER_DISMISS:return j(a)}}return null}function g(a){var c=a.from,d=a.payload;a=a.source;d=JSON.parse(d);var e=d.call_id,f=d.capability,g=d.label,h=d.msg_id,i=d.sdp,j=d.sdp_line_idx,k=d.sdp_mid;d=d.version;e={call_id:e,capability:f,from:c,label:g,msg_id:h,sdp:i,sdp_line_idx:j,sdp_mid:k,source:a,type:b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.ICE_CANDIDATE,version:d};return e}function h(a){var c,d,e,f,g=a.from,h=a.payload;a=a.source;h=JSON.parse(h);var i=h.call_id,j=h.calltype,k=h.capability;c=(c=h.escalation_conference_name)!=null?c:null;d=(d=h.experiments)!=null?d:[];e=(e=h.extraParams)!=null?e:[];f=(f=h.fbexp)!=null?f:"";var l=h.handlescollision!==void 0?h.handlescollision:!1,m=h.offer_escalation_support!==void 0?h.offer_escalation_support:!1,n=h.msg_id,o=h.sdp;h=h.videoon;i={call_id:i,calltype:j,capability:k,escalation_conference_name:c,experiments:d,extraParams:e,fbexp:f,from:g,handlescollision:l,msg_id:n,offer_escalation_support:m,sdp:o,source:a,type:b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OFFER,videoon:h};return i}function i(a){var c=a.from,d=a.payload;a=a.source;d=JSON.parse(d);var e=d.call_id,f=d.capability,g=d.msg_id,h=d.reason;d=d.subreason;e={call_id:e,capability:f,from:c,msg_id:g,reason:h,source:a,subreason:d,type:b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.HANG_UP};return e}function j(a){var c=a.from,d=a.payload;a=a.source;d=JSON.parse(d);var e=d.call_id,f=d.capability;d=d.msg_id;e={call_id:e,capability:f,from:c,msg_id:d,source:a,type:b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OTHER_DISMISS};return e}}),null);
__d("RTWebSignalingListener",["FBMqttChannel","ZenonDebugLogger","ZenonMWMessageTranslator","ZenonP2PMessageTranslator","ZenonP2PMessageValidator","recoverableViolation"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){}var c=a.prototype;c.subscribe=function(a,c,d){var e=this;b("FBMqttChannel").subscribe("/webrtc",function(d){var f=b("ZenonDebugLogger").getInstance(),g=b("ZenonP2PMessageValidator").getValidP2PMessage(d),h=b("ZenonP2PMessageValidator").transformP2PMessage(g);e.$1(d,c);if(h){d=b("ZenonP2PMessageTranslator").toSignalingMessage(h);d&&(f.logP2PMessageReceived(g),a(d),f.logP2PMessageProcessed(g))}});b("FBMqttChannel").subscribe("/rtc_multi",function(c){var f=JSON.parse(c),g=b("ZenonDebugLogger").getInstance();g.logMWMessage("RECEIVED [MQTT]",f);var h=b("ZenonMWMessageTranslator").toSignalingMessage(f);h&&(g.logReceivingMultiwayMessage(f),a(h),d&&e.$2(c,d),g.logProcessingMultiwayMessage(f))})};c.unsubscribe=function(){b("FBMqttChannel").unsubscribeAll("/webrtc"),b("FBMqttChannel").unsubscribeAll("/rtc_multi")};c.$1=function(a,c){try{a=JSON.parse(a);c(a)}catch(a){b("recoverableViolation")("Signaling messages should be json parsable. error:"+a,"rtweb")}};c.$2=function(a,c){try{a=JSON.parse(a);c(a)}catch(a){b("recoverableViolation")("Signaling messages should be json parsable. error:"+a,"rtweb")}};return a}();e.exports=a}),null);